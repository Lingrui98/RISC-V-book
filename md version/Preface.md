# 前言

**欢迎阅读！**

**RISC-V**自2011年推出以来迅速普及。我们认为，一份简洁的程序员指南将促进其发展，并帮助新人理解为什么这是一个有吸引力的指令集，以及其与传统指令集架构(**ISA**)的不同之处。

我们的灵感来源于其它**ISA**书籍，但是希望RISC-V自身的简洁性能让我们写得比《**MIPS**体系结构透视》（See MIPS Run）一类500多页的详尽书籍少很多。我们把全书的长度控制在了三分之一，至少在这个意义上是成功了。实际上，介绍模块化**RISC-V**指令集的各个组成部分的十个章节只用了100页 —— 即便为了有助于快速阅读，几乎平均每页用到了一张图片（一共75张）。

在解释指令集设计的原理之后，我们介绍**RISC-V**架构师如何学习过去40年的指令集，取其精华，去其糟粕。要评判一个指令集架构，不仅要看它包括了什么，而且要看它省略了什么。

随后我们按顺序介绍该模块化架构的每个组成部分。每一章都包含一个用**RISC-V**汇编语言写的程序，这是为了展示该章所述指令的用法，这样有助于汇编语言程序员学习**RISC-V**代码。有时，我们还会列出用**ARM**，**MIPS**和**x86**写的等价程序，从而突出**RISC-V**在简洁性，以及成本、功耗、性能方面的优势。

为了增加本书的趣味性，我们增加了近50个页边栏，里面放了一些书中有关内容的评论，希望它们能带来一些乐趣。我们还在页边放置了约75张图片，用于展示设计良好的**ISA**例子。（我们充分利用了页边空间！）最后，对于那些愿意钻研的读者，我们在全书中加入了约25段补充说明。如果你对某个主题感兴趣，可以深入研究这些可选部分。略过这些部分不会影响对书中其他内容的理解，所以，如果你不感兴趣的话，尽管跳过它们。对于计算机体系结构爱好者，我们引用的25篇论文和书籍能够开阔你的视野。在写这本书的过程中，我们从它们当中学到了很多！

**为什么引用了这么多名言？**

我们认为，引用这些名言也能增加本书的趣味性，因此，我们把这25个引用分散在了整本书里。它们同样是一种将智慧从前辈传递给初学者的有效机制，而且有助于为良好的**ISA**设计设定文化标准。我们希望读者也能了解一点该领域的历史，这就是我们在全书中引用了众多著名计算机科学家和工程师名言的原因。

**导言和参考**

我们打算将这本小书作为**RISC-V**的介绍和参考资料，供有兴趣编写**RISC-V**代码的学生和嵌入式系统程序员使用。本书假设读者事先已经了解过至少一个指令集。如果没有，可能希望浏览基于**RISC-V**的相关入门架构书籍：《计算机组成与设计 RISC-V版：硬件/软件接口》（*Computer Organization and Design RISC-V Edition: The Hardware Software Interface）。*

本书中的精简参考资料包括：

- **参考卡** —— 这一页（两面）的RISC-V的简洁地描述囊括了RV32GCV和RV64GCV，同时包含了基本内容和所有已定义的指令扩展：RVI, RVM, RVA, RVF, RVD，甚至包括了尚处在开发阶段的RVV。

- **指令图** —— 每个指令扩展的半页图形描述（它们是每一章的第一张图）以同样的格式列出了所有RISC-V指令的全称，让大家可以轻松查看每条指令的不同变种。见图2.1、4.1、5.1、6.1、7.1、8.1、9.1、9.2、9.3和9.4。

- **操作码映射** —— 这些表格在一页中显示了指令布局，操作码，格式类型和每页指令扩展的指令助记符。见图2.3、3.3、3.4、4.2、5.2、5.3、6.2、7.6、7.5、7.7、9.5和10.1。（这些指令图和操作码映射启发了我们在书的副标题中使用单词图集。）

- **指令术语表** —— 附录A是对每个RISC-V指令和伪指令的详尽描述[^1]。它包括所有内容：操作名称和操作数、英文描述、寄存器传输语言定义、它所在的RISC-V扩展、指令的全称、指令格式、显示操作码的指令图，以及紧凑版本指令的参照。令人惊讶的是，所有这些加起来不到50页。

- **索引** —— 可以帮你通过指令全称或助记符找到描述指令说明、定义或图表的页面。它是按照字典形式组织的。

**勘误和补充内容**

我们打算把勘误集中起来，每年发布几次更新。这本书的网站上会有本书的最新版本，还会简单介绍一下当前版本相对上一版本的改变。可在本书的[网站](www.riscvbook.com)上查看勘误表的历史版本或报告新的错误。我们预先为你在这一版中发现的问题表示歉意。我们期待反馈意见，来帮助我们改进此书。

**本书的诞生过程**

在2017年5月8日至11日于上海举办的第六届RISC-V研讨会上，我们认识到了对这么一本书的需求，几个星期后我们开始了编写。考虑到Patterson在写书方面的丰富经验，我们计划让他写大部分的章节。我们两人在组织方面进行了合作，并且是彼此章节的第一个评论者。Patterson撰写了第1、2、3、4、5、6、7、8、9、11章，参考卡和本前言，而Waterman写了第10章和附录A（本书的最大部分），并编写了书中的全部程序。Waterman还维护了Armando Fox提供的**LaTeX**工具，使我们能做出这本书。

我们在2017年秋季学期为加州大学伯克利分校的800名学生提供了这本教科书的测试版本。在吸收了他们的反馈后，第一版将于2017年11月28日至30日在硅谷举办的第七届**RISC**研讨会上及时发布。

**RISC-V**是一个伯克利研究项目的副产品。该项目正在开发针对更容易构建并行硬件和软件的技术。

**致谢**

我们要感谢Armando Fox，因为我们使用了他的**LaTeX**工具，并采纳了他关于个人出版的建议。

我们最深切的感谢要送给那些读了本书早期的草稿并提出了有用建议的人，比如：Krste Asanovi´c, Nikhil Athreya, C. Gordon Bell, Stuart Hoad, David Kanter, John Mashey, Ivan Sutherland, Ted Speers, Michael Taylor, Megan Wachs, ......

最后，我们要感谢数百名加州大学伯克利分校学生在调试方面的付出以及他们的对这些素材的持续热忱！

David Patterson 和 Andrew Waterman

2017年9月1日于加州伯克利

[^1]: 定义RV32V的委员会没有赶在本书的beta版之前完成他们的工作，所以我们在附录A中省略了这些指令。尽管到时候RV32V有可能会有一些微小的改变，第八章是我们对于它的最为接近的猜想。